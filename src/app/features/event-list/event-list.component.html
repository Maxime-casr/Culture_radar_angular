<section class="wrap">
  <header class="page-head">
    <h1>Explorer les événements</h1>
    <div class="actions">
      <button class="btn" type="button" (click)="useMyLocation()">Autour de moi</button>
      <button class="btn" type="button" (click)="usePresetLocation()">Autour de Paris</button>
    </div>
  </header>

  <!-- Barre de filtres -->
  <form class="filters" (ngSubmit)="resetAndSearch()" autocomplete="off">
    <div class="row">
      <input type="text" placeholder="Recherche" [(ngModel)]="q" name="q" />
      <input type="text" placeholder="Ville" [(ngModel)]="city" name="city" />
      <input type="date" [(ngModel)]="date_from" name="date_from" />
      <input type="date" [(ngModel)]="date_to" name="date_to" />
      <button type="submit" class="btn primary">Filtrer</button>
      <button type="button" class="btn ghost" (click)="clearFilters()">Réinitialiser</button>
      <button type="button" class="btn" (click)="showAdvanced = !showAdvanced">
        {{ showAdvanced ? 'Masquer' : 'Plus de filtres' }}
      </button>
    </div>

    <div class="advanced" *ngIf="showAdvanced">
      <!-- Heures -->
      <div class="group">
        <label class="group-title">Heure de début</label>
        <div class="inline">
          <input type="number" min="0" max="23" [(ngModel)]="hour_from" name="hour_from" placeholder="De (0-23)">
          <span>à</span>
          <input type="number" min="0" max="23" [(ngModel)]="hour_to" name="hour_to" placeholder="À (0-23)">
        </div>
      </div>

      <!-- Âge -->
      <div class="group">
        <label class="group-title">Âge recommandé</label>
        <div class="inline">
          <input type="number" [(ngModel)]="age_min_lte" name="age_min_lte" placeholder="Min" min="0">
          <span>à</span>
          <input type="number" [(ngModel)]="age_max_gte" name="age_max_gte" placeholder="Max" min="0">
        </div>
      </div>

      <!-- Mots-clés -->
      <div class="group">
        <label class="group-title">Mots-clés</label>
        <div class="inline" style="gap:8px; flex-wrap:wrap;">
          <input type="text"
                 [(ngModel)]="keywordInput" name="keywordInput"
                 (keydown.enter)="addKeyword('include'); $event.preventDefault();"
                 placeholder="Ajouter et Entrée (inclure)" />
          <button type="button" class="btn" (click)="addKeyword('exclude')">Ajouter en exclusion</button>
        </div>
        <div class="chips" style="margin-top:8px;">
          <strong>Inclure</strong>
          <span *ngFor="let k of kw_include" class="chip">+ {{ k }}
            <button type="button" (click)="removeInclude(k)">×</button>
          </span>
        </div>
        <div class="chips">
          <strong>Exclure</strong>
          <span *ngFor="let k of kw_exclude" class="chip">− {{ k }}
            <button type="button" (click)="removeExclude(k)">×</button>
          </span>
        </div>
      </div>

      <!-- Distance -->
      <div class="group">
        <label class="group-title">Distance</label>
        <div class="inline">
          <input type="number" min="1" max="200" [(ngModel)]="radius_km" name="radius_km" placeholder="Rayon (km)">
          <button type="button" class="btn" (click)="geocodeCity()">Géocoder la ville</button>
        </div>
        <p *ngIf="lat && lon" class="hint">Centre: {{lat | number:'1.4-4'}}, {{lon | number:'1.4-4'}}</p>
      </div>
    </div>
  </form>

  <!-- Résultats -->
  <div *ngIf="loading" class="loading">Chargement…</div>
  <div *ngIf="!loading && events.length === 0" class="empty">Aucun résultat.</div>

  <div class="grid" *ngIf="!loading && events.length">
    <article class="card" *ngFor="let e of events">
      <div class="thumb">
        <img [src]="e.image_url" [attr.alt]="e.title" (error)="onImgError($event)" />
        <span class="badge" *ngIf="e.date">{{ e.date | date:'EEE d MMM • HH:mm' }}</span>
         <div class="owner-badge" *ngIf="e.owner_id">
        <img src="/logo.png" alt="Organisateur">
      </div>

      </div>
      <div class="info">
        <h3>{{ e.title }}</h3>
         <div class="rating" *ngIf="e.ratingAvg !== null">
        <span class="stars" aria-label="Note moyenne">
          <ng-container *ngFor="let s of makeStars(e.ratingAvg)">
            <span class="star" [class.full]="s === 'full'">★</span>
          </ng-container>
        </span>
        <span class="rating-num">{{ e.ratingAvg | number:'1.1-1' }}</span>
        <span class="rating-count">({{ e.ratingCount }})</span>
      </div>
      
        <p class="meta">
          <span *ngIf="e.lieu">{{ e.lieu }}</span>
          <span *ngIf="e.commune">• {{ e.commune }}</span>
        </p>
        <a [routerLink]="['/event', e.id]" class="btn primary">Voir</a>
      </div>
    </article>
  </div>

  <!-- Pagination -->
  <div class="pager" *ngIf="!loading">
    <button class="btn" (click)="prevPage()" [disabled]="page===1">← Précédent</button>
    <span>Page {{ page }}</span>
    <button class="btn" (click)="nextPage()" [disabled]="events.length < per_page">Suivant →</button>
  </div>
</section>








